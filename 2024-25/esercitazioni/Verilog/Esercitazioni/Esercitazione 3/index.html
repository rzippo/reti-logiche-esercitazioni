<!doctype html>
<html lang="it" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-2024-25 docs-doc-page docs-doc-id-esercitazioni/Verilog/Esercitazioni/Esercitazione 3" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.1">
<title data-rh="true">Esercitazione 3 | Esercitazioni di Reti Logiche</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 3"><meta data-rh="true" property="og:locale" content="it"><meta data-rh="true" name="docusaurus_locale" content="it"><meta data-rh="true" name="docsearch:language" content="it"><meta data-rh="true" name="docusaurus_version" content="2024-25"><meta data-rh="true" name="docusaurus_tag" content="docs-default-2024-25"><meta data-rh="true" name="docsearch:version" content="2024-25"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-2024-25"><meta data-rh="true" property="og:title" content="Esercitazione 3 | Esercitazioni di Reti Logiche"><link data-rh="true" rel="icon" href="/reti-logiche-esercitazioni/img/favicon.png"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 3"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 3" hreflang="it"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 3" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://X6QFHIGLL7-dsn.algolia.net" crossorigin="anonymous"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Verilog","item":"https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/2024-25/category/verilog"},{"@type":"ListItem","position":2,"name":"Esercitazioni","item":"https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/2024-25/category/esercitazioni-1"},{"@type":"ListItem","position":3,"name":"Esercitazione 3","item":"https://your-docusaurus-site.example.com/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 3"}]}</script><link rel="alternate" type="application/rss+xml" href="/reti-logiche-esercitazioni/blog/rss.xml" title="Esercitazioni di Reti Logiche RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/reti-logiche-esercitazioni/blog/atom.xml" title="Esercitazioni di Reti Logiche Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-GHFPG7JFTZ"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-GHFPG7JFTZ",{anonymize_ip:!0})</script>



<link rel="search" type="application/opensearchdescription+xml" title="Esercitazioni di Reti Logiche" href="/reti-logiche-esercitazioni/opensearch.xml">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.24/dist/katex.min.css" integrity="sha384-odtC+0UGzzFL/6PNoE8rX/SPcQDXBJ+uRepguP4QkPCm2LBxH3FA3y+fKSiJ+AmM" crossorigin="anonymous"><link rel="stylesheet" href="/reti-logiche-esercitazioni/assets/css/styles.e959b96b.css">
<script src="/reti-logiche-esercitazioni/assets/js/runtime~main.c63a87f2.js" defer="defer"></script>
<script src="/reti-logiche-esercitazioni/assets/js/main.4d1e8c9b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Passa al contenuto principale"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Passa al contenuto principale</a></div><nav aria-label="Principale" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Attiva/disattiva la barra di navigazione" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/reti-logiche-esercitazioni/"><div class="navbar__logo"><img src="/reti-logiche-esercitazioni/img/logo.png" alt="Reti Logiche" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/reti-logiche-esercitazioni/img/logo.png" alt="Reti Logiche" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Esercitazioni di Reti Logiche</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/reti-logiche-esercitazioni/2024-25/">Esercitazioni</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 3">2024-25</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/reti-logiche-esercitazioni/esercitazioni/Verilog/Esercitazioni/Esercitazione 3">2025-26</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 3">2024-25</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Passa dalla modalità scura a quella chiara (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Cerca (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 24 24" aria-hidden="true"><circle cx="11" cy="11" r="8" stroke="currentColor" fill="none" stroke-width="1.4"></circle><path d="m21 21-4.3-4.3" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Cerca</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Torna indietro all&#x27;inizio" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Barra laterale dei documenti" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reti-logiche-esercitazioni/2024-25/"><span title="Esercitazioni di Reti Logiche" class="linkLabel_WmDU">Esercitazioni di Reti Logiche</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Introduzione"><span title="Introduzione" class="linkLabel_WmDU">Introduzione</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/reti-logiche-esercitazioni/2024-25/category/assembler"><span title="Assembler" class="categoryLinkLabel_W154">Assembler</span></a><button aria-label="Expand sidebar category &#x27;Assembler&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/reti-logiche-esercitazioni/2024-25/category/verilog"><span title="Verilog" class="categoryLinkLabel_W154">Verilog</span></a><button aria-label="Collapse sidebar category &#x27;Verilog&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/category/esercitazioni-1"><span title="Esercitazioni" class="categoryLinkLabel_W154">Esercitazioni</span></a><button aria-label="Collapse sidebar category &#x27;Esercitazioni&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 1"><span title="Esercitazione 1" class="linkLabel_WmDU">Esercitazione 1</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 2"><span title="Esercitazione 2" class="linkLabel_WmDU">Esercitazione 2</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 3"><span title="Esercitazione 3" class="linkLabel_WmDU">Esercitazione 3</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 4"><span title="Esercitazione 4" class="linkLabel_WmDU">Esercitazione 4</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 5"><span title="Esercitazione 5" class="linkLabel_WmDU">Esercitazione 5</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 6"><span title="Esercitazione 6" class="linkLabel_WmDU">Esercitazione 6</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/category/documentazione-1"><span title="Documentazione" class="categoryLinkLabel_W154">Documentazione</span></a><button aria-label="Expand sidebar category &#x27;Documentazione&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Simulatore processore sEP8"><span title="Simulatore processore sEP8" class="linkLabel_WmDU">Simulatore processore sEP8</span></a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/VS-Code"><span title="Uso di VS Code" class="linkLabel_WmDU">Uso di VS Code</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Versioni PDF"><span title="Versioni PDF" class="linkLabel_WmDU">Versioni PDF</span></a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>Questa è la documentazione per <!-- -->Esercitazioni di Reti Logiche<!-- --> <b>2024-25</b>, che non è più attivamente mantenuta.</div><div class="margin-top--md">Per la documentazione aggiornata, guarda la <b><a href="/reti-logiche-esercitazioni/esercitazioni/Verilog/Esercitazioni/Esercitazione 3">ultima versione</a></b> (<!-- -->2025-26<!-- -->).</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Briciole di pane"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Pagina principale" class="breadcrumbs__link" href="/reti-logiche-esercitazioni/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/reti-logiche-esercitazioni/2024-25/category/verilog"><span>Verilog</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/reti-logiche-esercitazioni/2024-25/category/esercitazioni-1"><span>Esercitazioni</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Esercitazione 3</span></li></ul></nav><span class="theme-doc-version-badge badge badge--secondary">Versione: 2024-25</span><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">Su questa pagina</button></div><div class="theme-doc-markdown markdown"><header><h1>Esercitazione 3</h1></header>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="reti-sincronizzate">Reti sincronizzate<a href="#reti-sincronizzate" class="hash-link" aria-label="Link diretto a Reti sincronizzate" title="Link diretto a Reti sincronizzate" translate="no">​</a></h2>
<p>Le reti sincronizzate sono reti logiche con uno stato interno, mantenuto usando registri, che si evolvono a instanti discreti dati da un segnale di clock.
In questa esercitazione vedremo come realizzarle, simularle e studiarle nell&#x27;ambiente d&#x27;esame.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testbench-e-generatore-di-clock">Testbench e generatore di clock<a href="#testbench-e-generatore-di-clock" class="hash-link" aria-label="Link diretto a Testbench e generatore di clock" title="Link diretto a Testbench e generatore di clock" translate="no">​</a></h3>
<p>Per poter simulare una rete sincronizzata dobbiamo innanzitutto avere un generatore di clock.
Il segnale di clock è segnale oscillante, che dal punto di vista logico appare come in figura.</p>
<img src="/reti-logiche-esercitazioni/2024-25/img/verilog/3/clock.drawio.png" style="max-width:min(100%, 28rem)" alt="
Grafico ideale di un segnale di clock.
Il segnale passa nettamente da &#x27;0&#x27; a &#x27;1&#x27; e viceversa a intervalli regolari, 
creando un fronte perfettamente squadrato.
">
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Clock in realtà</div><div class="admonitionContent_BuS1"><p>In realtà i generatori di clock sono basati su cristalli di quarzo, un materiale <em>piezoelettrico</em> con il quale si possono realizzare circuiti oscillanti.
Questi circuiti emettono una tensione oscillante come mostrato in figura (da Wikimedia), notare come l&#x27;onda sia molto meno squadrata di quanto presentato a livello logico.</p><img src="https://upload.wikimedia.org/wikipedia/commons/0/0e/Clock_signal.png" style="max-width:min(100%, 30rem)" alt="
Grafico reale di un segnale di clock.
Il grafico oscilla intorno ai valori &#x27;0&#x27; e &#x27;1&#x27;, e le transizioni non sono nette.
In particolare, oscilla tra &#x27;1&#x27; meno positive undershoot e &#x27;1&#x27; più positive overshoot; e tra &#x27;0&#x27; meno negative undershoot e &#x27;0&#x27; più negative overshoot.
Le transizioni sono caratterizzate da un rise time e da un fall time.
"></div></div>
<p>Per i nostri usi, ci basterà descrivere una rete asincrona che cambia il proprio segnale da 0 a 1, e viceversa, ad intervalli regolari.
Una qualunque descrizione realistica, e dunque <em>sintetizzabile</em>, dovrebbe avere a che fare con un segnale di reset che indichi a questa rete da che punto cominciare.
Dato però che vogliamo usare questo generatore in una testbench simulativa, possiamo utilizzare direttamente i concetti relativi, approfittando della keyword <code>initial</code> per mantenere il codice <em>semplice</em>.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token comment" style="color:#999988;font-style:italic">// generatore del segnale di clock</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> clock_generator</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    clock</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">output</span><span class="token plain"> clock;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token parameter constant" style="color:#36acaa">parameter</span><span class="token plain"> HALF_PERIOD </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 5;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> CLOCK;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> clock </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> CLOCK;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">initial</span><span class="token plain"> CLOCK </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> #HALF_PERIOD CLOCK </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">~</span><span class="token plain">CLOCK;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token block function" style="color:#d73a49">endmodule</span></span><br></span></code></pre></div></div>
<p>Notiamo che questa rete <em>non è sintetizzabile</em>. Infatti, utilizza la keyword <code>initial</code>, che è priva di senso in hardware, e un <code>reg</code> non come registro ma come variabile, come già visto nelle testbench.
Questo si nota dal fatto che il <code>reg</code> non viene aggiornato in risposta a un altro segnale, come il positive edge del clock, come invece accade per registri.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Periodo del clock</div><div class="admonitionContent_BuS1"><p>Il parametro <code>HALF_PERIOD</code> rende il periodo di questo generatore di clock configurabile.
Tipicamente all&#x27;esame viene utilizzato il valore default di 5, che implica periodi di clock di 10 unità di tempo.
Qualora questo cambiasse (per esempio, per permettere reti combinatorie con maggior tempo di attraversamento) sarà segnalato nel testo.</p></div></div>
<p>Come ogni altra rete, questa viene inclusa nella testbench con una instanziazione.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> testbench</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">wire</span><span class="token plain"> clock;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    clock_generator clk</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mia_rete dut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span></code></pre></div></div>
<p>Oltre al segnale di clock, una rete sincronizzata avrà bisogno anche del segnale di reset.
Questo viene aggiunto come un <code>reg</code> pilotato all&#x27;inizio del blocco <code>initial</code> della testbench.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> testbench</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> reset_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    mia_rete dut</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        .clock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">clock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> .reset_</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">initial</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reset_ </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token delay constant" style="color:#36acaa">#(clk.HALF_PERIOD);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reset_ </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><br></span></code></pre></div></div>
<p>Con la sintassi <code>#(clk.HALF_PERIOD);</code> si attendono unità di tempo proporzionali al periodo di clock configurato. Questo è utile ad evitare di modificare manualmente tutte le attese in caso di cambio di clock.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="primo-esempio-di-rete-sincronizzata-il-contatore">Primo esempio di rete sincronizzata: il contatore<a href="#primo-esempio-di-rete-sincronizzata-il-contatore" class="hash-link" aria-label="Link diretto a Primo esempio di rete sincronizzata: il contatore" title="Link diretto a Primo esempio di rete sincronizzata: il contatore" translate="no">​</a></h3>
<p>Vediamo ora un semplice esempio di rete sincronizzata, un contatore.
Questa rete ha un registro di 3 bit inizializzato a 0, che viene incrementato ad ogni ciclo di clock, facendo infine wrap-around da 7 a 0.
Il codice è scaricabile <a href="/reti-logiche-esercitazioni/2024-25/code/verilog/3/contatore/contatore-1.v" target="_blank" rel="noopener noreferrer">qui</a>.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> contatore </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    clock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reset_</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">output</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> out;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">input</span><span class="token plain"> clock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reset_;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> OUT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> out </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> OUT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_ == 0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        OUT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posedge clock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_ == 1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token delay constant" style="color:#36acaa">#3</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        OUT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> OUT </span><span class="token brackets operator" style="color:#393A34">+</span><span class="token plain"> 1;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token block function" style="color:#d73a49">endmodule</span></span><br></span></code></pre></div></div>
<p>Vediamo quindi come questo codice modella il comportamento di una vera rete sincronizzata. Il <code>reg</code> <code>OUT</code> viene collegato direttamente all&#x27;uscita <code>out</code>, viene inizializzato a 0 solo in corrispondenza del segnale di reset (righe 11-13) e, durante la normale operazione, viene aggiornato con il valore <code>OUT + 1</code> in corrispondenza di un <code>posedge</code> del clock.
Il ritardo <code>#3</code> modella il tempo <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>p</mi><mi>r</mi><mi>o</mi><mi>p</mi><mi>a</mi><mi>g</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{propagation}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ro</span><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span><span class="mord mathnormal mtight">a</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">i</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight">n</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span> del registro.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Assegnamento con <code>&lt;=</code></div><div class="admonitionContent_BuS1"><p>È importante, nelle reti sincronizzate, utilizzare <code>&lt;=</code> per assegnamenti a registri sul fronte positivo del clock.
Questo perché gli statement con <code>&lt;=</code> sono intesi come eseguiti <em>in parallelo</em>, non <em>sequenzialmente</em>.
Infatti, i registri non sono variabili e i loro cambiamenti non sono visibili agli altri registri fino al successivo posedge del clock.</p></div></div>
<p>Possiamo vedere come si evolve questa rete, simulandola in una testbench con segnale di clock e reset_ (scaricabile <a href="/reti-logiche-esercitazioni/2024-25/code/verilog/3/contatore/testbench.v" target="_blank" rel="noopener noreferrer">qui</a>). Per il resto, la testbench non fa altro che attendere diversi cicli di clock, visto che questa rete non ha alcun input e si evolve in autonomia.</p>
<p>Vediamo l&#x27;evoluzione della rete usando GTKWave.</p>
<img src="/reti-logiche-esercitazioni/2024-25/img/verilog/3/contatore-1.png" style="max-width:min(100%, 50rem)" alt="
Vista in GTKWave dell&#x27;evoluzione nel tempo di &#x27;clock&#x27;, &#x27;reset_&#x27;, &#x27;OUT&#x27; e &#x27;out&#x27;. 
">
<p>Osserviamo, in particolare, il registro <code>OUT</code> e il segnale del clock.
Notiamo che a ogni fronte positivo del clock, <code>OUT</code> non cambia immediatamente, ma solo dopo 3 unità	di tempo.</p>
<p>Dalla teoria sui registri, ricordiamo anche che il nuovo valore assunto dal registro deve essergli dato in input da <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>s</mi><mi>e</mi><mi>t</mi><mi>u</mi><mi>p</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{setup}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9694em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.2806em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">se</span><span class="mord mathnormal mtight">t</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight">p</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span> prima del posedge e fino a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>T</mi><mrow><mi>h</mi><mi>o</mi><mi>l</mi><mi>d</mi></mrow></msub></mrow><annotation encoding="application/x-tex">T_{hold}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8333em;vertical-align:-0.15em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.13889em">T</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.1389em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">h</span><span class="mord mathnormal mtight">o</span><span class="mord mathnormal mtight" style="margin-right:0.01968em">l</span><span class="mord mathnormal mtight">d</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em"><span></span></span></span></span></span></span></span></span></span> dopo il posedge.
Questo però non si nota da questa waveform: non c&#x27;è nulla che rappresenta il valore in ingresso al registro prima del posedge.
Torniamo al codice: alla riga 16 usiamo una espressione combinatoria a sinistra dell&#x27;assegnamento.
Questa espressione viene calcolata dal simulatore Verilog al momento dell&#x27;assegnamento, cioè <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>t</mi><mrow><mi>p</mi><mi>o</mi><mi>s</mi><mi>e</mi><mi>d</mi><mi>g</mi><mi>e</mi></mrow></msub><mo>+</mo><mn>3</mn></mrow><annotation encoding="application/x-tex">t_{posedge} + 3</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.9012em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight">p</span><span class="mord mathnormal mtight">ose</span><span class="mord mathnormal mtight">d</span><span class="mord mathnormal mtight" style="margin-right:0.03588em">g</span><span class="mord mathnormal mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">3</span></span></span></span>, e non prima.
Ciò significa che il simulatore non sta simulando né il risultato combinatorio in ingresso al registro, né il fatto che sia settato e mantenuto per i giusti tempi.</p>
<p>Possiamo ovviare al primo di questi problemi introducendo un <code>wire</code>, che ci rappresenti la rete combinatoria che calcola il successivo valore di <code>OUT</code> (scaricabile <a href="/reti-logiche-esercitazioni/2024-25/code/verilog/3/contatore/contatore-2.v" target="_blank" rel="noopener noreferrer">qui</a>).</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> contatore </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    clock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reset_</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">output</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> out;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">input</span><span class="token plain"> clock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reset_;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> OUT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> out </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> OUT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">wire</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> next_out;</span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> </span><span class="token delay constant" style="color:#36acaa">#2</span><span class="token plain"> next_out </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> OUT </span><span class="token brackets operator" style="color:#393A34">+</span><span class="token plain"> 1;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_ == 0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        OUT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posedge clock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_ == 1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token delay constant" style="color:#36acaa">#3</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line theme-code-block-highlighted-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        OUT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> next_out;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token block function" style="color:#d73a49">endmodule</span></span><br></span></code></pre></div></div>
<p>Simulando questa nuova rete, otteniamo la seguente waveform.</p>
<img src="/reti-logiche-esercitazioni/2024-25/img/verilog/3/contatore-2.png" style="max-width:min(100%, 50rem)" alt="
Vista in GTKWave con l&#x27;aggiunta di &#x27;next_out&#x27;.
&#x27;next_out&#x27; mostra transizioni poco dopo le transizioni di &#x27;OUT&#x27;, assumendo il prossimo valore di &#x27;OUT&#x27; molto prima del fronte positivo del clock.
">
<p>Vediamo ora chiaramente che la rete combinatoria che produce <code>next_out</code> risponde quasi immediatamente, ma il registro <code>OUT</code> non registrerà il suo valore fino al prossimo posdege del clock.
Infatti, il periodo che separa due posedge è utilizzato proprio per far propagare i nuovi valori dei registri attraverso reti combinatorie, che andranno a produrre i nuovi ingressi dei registri che questi registreranno al prossimo posedge.</p>
<p>Questo modo di propagarsi dei valori tra un ciclo di clock è l&#x27;altro è fondamentale per capire come funzionano le reti sincronizzate ed essere quindi in grado di scrivere Verilog corrispondente alla macchina a stati che vogliamo realizzare.
Allo stesso modo, riuscire a leggere questa evoluzione dalla waveform è fondamentale per rendere queste utili al debugging.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="mantenere-un-segnale-per-n-cicli-di-clock">Mantenere un segnale per N cicli di clock<a href="#mantenere-un-segnale-per-n-cicli-di-clock" class="hash-link" aria-label="Link diretto a Mantenere un segnale per N cicli di clock" title="Link diretto a Mantenere un segnale per N cicli di clock" translate="no">​</a></h3>
<p>Vediamo ora l&#x27;esempio di una rete sincronizzata con uscita <code>out</code> a 1 bit, che, ciclicamente, viene tenuta a 1 per N clock e messa a 0 per 1 clock.
Il codice è scaricabile in due versioni, <a href="/reti-logiche-esercitazioni/2024-25/code/verilog/3/out_n_clock/out_n_clock-1.v" target="_blank" rel="noopener noreferrer">qui</a> senza <code>wire</code> di debug e <a href="/reti-logiche-esercitazioni/2024-25/code/verilog/3/out_n_clock/out_n_clock-2.v" target="_blank" rel="noopener noreferrer">qui</a> con, mentre la testbench è <a href="/reti-logiche-esercitazioni/2024-25/code/verilog/3/out_n_clock/testbench.v" target="_blank" rel="noopener noreferrer">qui</a>.</p>
<p>Per semplicità, discutiamo direttamente la versione che usa <code>wire</code> di debug per evidenziare gli ingressi dei registri.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> out_n_clock</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    out</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    clock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reset_</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">output</span><span class="token plain"> out;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">input</span><span class="token plain"> clock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reset_;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> OUT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> out </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> OUT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token parameter constant" style="color:#36acaa">localparam</span><span class="token plain"> N </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 3;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> COUNT;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> STAR;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token parameter constant" style="color:#36acaa">localparam</span><span class="token plain"> S0 </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> S1 </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 1;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_ == 0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        COUNT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> N;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        OUT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        STAR </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> S0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">wire</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> next_count_s0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> </span><span class="token delay constant" style="color:#36acaa">#2</span><span class="token plain"> next_count_s0 </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> COUNT </span><span class="token brackets operator" style="color:#393A34">-</span><span class="token plain"> 1;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">wire</span><span class="token plain"> next_star_s0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> </span><span class="token delay constant" style="color:#36acaa">#2</span><span class="token plain"> next_star_s0 </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">COUNT == 1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ? S1 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> S0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posedge clock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_ == 1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token delay constant" style="color:#36acaa">#3</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token block function" style="color:#d73a49">casex</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">STAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            S0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                COUNT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> next_count_s0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                OUT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 1;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                STAR </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> next_star_s0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            S1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                COUNT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> N;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                OUT </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                STAR </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> S0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token block function" style="color:#d73a49">endcase</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token block function" style="color:#d73a49">endmodule</span></span><br></span></code></pre></div></div>
<p>Questa rete inizializza <code>COUNT</code> a <code>N</code> e, in S0, lo decrementa continuamente.
Anziché saltare da S0 a S1 quando <code>COUNT</code> raggiunge 0, lo facciamo invece quando raggiunge 1.
Perché? Guardiamo la waveform per capirlo meglio.</p>
<img src="/reti-logiche-esercitazioni/2024-25/img/verilog/3/out_n_clock-2.png" style="max-width:min(100%, 50rem)" alt="
Vista in GTKWave della rete.
Notiamo in particolare come &#x27;next_count_s0&#x27; e &#x27;next_start_s0&#x27; si aggiornino molto prima di &#x27;COUNT&#x27; e &#x27;STAR&#x27;, sempre perché i registri attendono il fronte positivo del clock.
">
<p>A <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>15</mn></mrow><annotation encoding="application/x-tex">t = 15</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">15</span></span></span></span> corrisponde il primo posedge del clock con <code>reset_</code> a 1.
Notiamo che a questo punto <code>OUT</code> è a 0 per via dell&#x27;inizializzazione, ma a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>18</mn></mrow><annotation encoding="application/x-tex">t = 18</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">18</span></span></span></span> questo passa a 1, conseguenza della riga 33.
Per <code>COUNT</code>, invece, notiamo che è stato inizializzato a 3, e subito dopo <code>next_count_s0</code> ha calcolato 2 come prossimo valore. A <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>18</mn></mrow><annotation encoding="application/x-tex">t = 18</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">18</span></span></span></span>, <code>COUNT</code> decrementa a 2.</p>
<p>Passiamo ora al clock successivo, cioè <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>25</mn></mrow><annotation encoding="application/x-tex">t = 25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">25</span></span></span></span>. <code>COUNT</code> vale 2, assume poco dopo valore 1, a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>28</mn></mrow><annotation encoding="application/x-tex">t = 28</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">28</span></span></span></span>.
Notiamo <code>next_star_s0</code> a cavallo di questo cambiamento: subito dopo il passaggio di <code>COUNT</code> a 1, <code>next_star_s0</code> diventa S1.
Siamo però a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>30</mn></mrow><annotation encoding="application/x-tex">t = 30</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">30</span></span></span></span>, non <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>25</mn></mrow><annotation encoding="application/x-tex">t = 25</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">25</span></span></span></span>: il check sul valore di <code>COUNT</code> non cambia fino a <em>dopo</em> il posedge del clock, e quindi <code>STAR</code> rimane S0 per un altro ciclo.
Al ciclo dopo, a <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mn>38</mn></mrow><annotation encoding="application/x-tex">t = 38</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.6151em"></span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:0.2778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em"></span></span><span class="base"><span class="strut" style="height:0.6444em"></span><span class="mord">38</span></span></span></span>, vediamo che lo stato passa dunque a S1, ma <code>OUT</code> resta 1: infatti solo al clock dopo il cambio di stato avrà effetto sui registri, compreso <code>COUNT</code> che viene reinizializzato.
Guardando il filo <code>OUT</code> in tutto ciò, notiamo che è rimasto effettivamente a 1 per <code>N = 3</code> cicli di clock, come da specifica.</p>
<p>Ci sono diversi fattori che possiamo cambiare, ottenendo risultati diversi. Se inizializziamo <code>COUNT</code> a <code>N - 1</code>, seguendo la stessa logica dovremmo contare fino a 0.
Se anticipiamo il cambio di <code>OUT</code>, usando <code>OUT &lt;= (COUNT == 1) ? 0 : 1</code>, allora si perde il ciclo in più con <code>OUT</code> a 1 e dovremmo cambiare il conteggio di conseguenza.
Anche per strutture apparentemente così semplici, è quindi possibile combinare tanti approcci diversi al punto tale che è difficile dedurre a colpo d&#x27;occhio la durata del segnale.
È per questo importante sapere come si evolvono i vari registri, come si propagano i loro cambi di valori, come ricostruire (e leggere) una waveform.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Partire da N bassi</div><div class="admonitionContent_BuS1"><p>Nello ragionare su comportamenti di questo tipo, che sia a mente o su carta, è una buona idea partire da <code>N</code> bassi, come 1 o 2, e calcolare la durata del segnale in termini di <code>N</code>.
Per esempio, in questo esercizio abbiamo visto che inizializzando <code>COUNT</code> a <code>N</code> otteniamo <code>OUT</code> a 1 per <code>N</code> cicli di clock.
Questo varrà che <code>N</code> sia 3 o che sia 12, ma <code>N = 3</code> è molto più rapido da verificare, e <code>N = 2</code> lo è ancora di più.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="esercizio-handshake-e-reti-combinatorie">Esercizio: Handshake e reti combinatorie<a href="#esercizio-handshake-e-reti-combinatorie" class="hash-link" aria-label="Link diretto a Esercizio: Handshake e reti combinatorie" title="Link diretto a Esercizio: Handshake e reti combinatorie" translate="no">​</a></h3>
<p>Vediamo un esempio di semplice esercizio che segue uno schema tipico all&#x27;esame.
Il testo è scaricabile <a href="/reti-logiche-esercitazioni/2024-25/code/verilog/3/perimetro_rettangolo/testo.zip" target="_blank" rel="noopener noreferrer">qui</a>.</p>
<p>La testbench è più complessa di quanto visto finora, nella prossima sezione vedremo le principali caratteristiche utili per debugging.
Per ora, vediamo come si realizza una rete che risponde a queste specifiche.</p>
<p>Il testo ci chiede di eseguire un handshake dav_/rfd con il produttore.
Questo handshake prevede che, tramite il filo <code>rfd</code> (&quot;ready for data&quot;) che va dal consumatore al produttore e il filo <code>dav_</code> (&quot;data valid&quot;, attivo basso) che va dal produttore al consumatore, questi si coordinino per la corretta trasmissione del dato.
Ricordiamo i passi di questo protocollo:</p>
<ul>
<li>A riposo: <code>dav_ = 1</code>, <code>rfd = 1</code>.</li>
<li>Comincia il produttore: <code>dav_ = 0</code>. Questo segnala che il dato è valido.</li>
<li>ACK del consumatore: <code>rfd = 0</code>. Questo segnala che il dato è stato letto.</li>
<li>Reset del produttore: <code>dav_ = 1</code>.</li>
<li>Reset del consumatore: <code>rfd = 1</code>.</li>
</ul>
<p>Un <em>protocollo</em>, in generale, descrive come due o più attori devono interagire tra loro.
Quando implementiamo un attore di un protocollo, ci sono due punti importanti da ricordare perché questo funzioni:</p>
<ol>
<li>vanno eseguiti <em>tutti</em> gli step che ci competono, <em>quando</em> il protocollo ci dice di farlo;</li>
<li>quando il protocollo dice che <em>qualcun&#x27;altro</em> deve segnalare qualcosa, dobbiamo <em>attendere</em> che questo accada.</li>
</ol>
<p>In questo esercizio, implementiamo il consumatore, che deve prelevare un dato dal produttore.
Rileggiamo quindi il protocollo di sopra dal punto di vista del consumatore, per capire cos&#x27;è che dobbiamo fare nella nostra rete.</p>
<ul>
<li>A riposo, e in particolare al reset iniziale: <code>rfd = 1</code>.</li>
<li>Attendiamo che il produttore segnali <code>dav_ = 0</code>.</li>
<li>Leggiamo il dato.</li>
<li>Comunichiamo l&#x27;avvenuta lettura con <code>rfd = 0</code>.</li>
<li>Attendiamo che il produttore segnali <code>dav_ = 1</code>.</li>
<li>Segnaliamo il reset del protocollo con <code>rfd = 1</code>.</li>
</ul>
<p>Dall&#x27;altra parte, una volta ottenuto il dato valido per <code>a</code> e <code>b</code>, svolgiamo il conto prescritto utilizzando una rete combinatoria e ne emettiamo il risultato tramite l&#x27;uscita <code>p</code>.</p>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Ordine delle operazioni</div><div class="admonitionContent_BuS1"><p>Non c&#x27;è nessuna prescrizione rigida sull&#x27;ordine delle operazioni tra gli step del protocollo e l&#x27;immissione del dato in uscita.
È valido sia completare l&#x27;handshake fino al suo reset e <em>poi</em> trasmettere il dato, sia trasmettere immediatamente il dato e poi chiudere l&#x27;handshake.</p><p>La testbench dovrà tenere conto di ciò.</p></div></div>
<p>Nello svolgere il calcolo, dobbiamo implementare una semplice rete combinatoria.
L&#x27;aspetto più interessante è come usarla: dobbiamo assicurarci di campionarne l&#x27;output solo quando gli input relativi sono validi.</p>
<p>Da questi ragionamenti, deriviamo la seguente descrizione, scaricabile <a href="/reti-logiche-esercitazioni/2024-25/code/verilog/3/perimetro_rettangolo/soluzione.v" target="_blank" rel="noopener noreferrer">qui</a>.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm" style="counter-reset:line-count 0"><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> ABC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    dav_</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rfd</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    clock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reset_</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">input</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">output</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">5</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> p;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">input</span><span class="token plain"> dav_;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">output</span><span class="token plain"> rfd;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">input</span><span class="token plain"> clock</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> reset_;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">5</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> P;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> p </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> P;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> RFD;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> rfd </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> RFD;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> A</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> B;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">wire</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">5</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> out_rc;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    PERIMETRO_RC rc</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        .a</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">A</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> .b</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        .p</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">out_rc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> STAR;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token parameter constant" style="color:#36acaa">localparam</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        S0 </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        S1 </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        S2 </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        S3 </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 3;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_ == 0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        RFD </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 1;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        P </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        STAR </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> S0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posedge clock</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">reset_ == 1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token delay constant" style="color:#36acaa">#3</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token block function" style="color:#d73a49">casex</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">STAR</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            S0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                A </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> a;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                B </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> b;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                STAR </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dav_ == 0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ? S1 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> S0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"> </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            S1</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                P </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> out_rc;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                STAR </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> S2;           </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain">  </span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            S2</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                RFD </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                STAR </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">dav_ == 1</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> ? S3 </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> S2;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            S3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                RFD </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> 1;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">                STAR </span><span class="token assignment keyword" style="color:#00009f">&lt;=</span><span class="token plain"> S0;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        </span><span class="token block function" style="color:#d73a49">endcase</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token block function" style="color:#d73a49">endmodule</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> PERIMETRO_RC</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    p</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">input</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> a</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">output</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">5</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> p;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">wire</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">4</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token plain"> somma;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    add #</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"> .N</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">4</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> adder</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        .x</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">a</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> .y</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">b</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> .c_in</span><span class="token punctuation" style="color:#393A34">(</span><span class="token literal-binary-number number" style="color:#36acaa">1&#x27;b0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">        .s</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">somma</span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> .c_out</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">somma</span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">4</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">assign</span><span class="token plain"> p </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">{</span><span class="token plain"> somma</span><span class="token brackets operator" style="color:#393A34">[</span><span class="token plain">3</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">0</span><span class="token brackets operator" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token literal-binary-number number" style="color:#36acaa">1&#x27;b0</span><span class="token plain"> </span><span class="token brackets operator" style="color:#393A34">}</span><span class="token plain">;</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#393A34"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token block function" style="color:#d73a49">endmodule</span></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="testbench-con-input-e-output-per-reti-sincronizzate">Testbench con input e output per reti sincronizzate<a href="#testbench-con-input-e-output-per-reti-sincronizzate" class="hash-link" aria-label="Link diretto a Testbench con input e output per reti sincronizzate" title="Link diretto a Testbench con input e output per reti sincronizzate" translate="no">​</a></h3>
<p>Ci muoviamo ora verso reti sincronizzate più complesse, che prendono input da altre reti, svolgono conti, ed emettono output.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="blocchi-in-parallelo-fork--join">Blocchi in parallelo: <code>fork ... join</code><a href="#blocchi-in-parallelo-fork--join" class="hash-link" aria-label="Link diretto a blocchi-in-parallelo-fork--join" title="Link diretto a blocchi-in-parallelo-fork--join" translate="no">​</a></h4>
<p>Per scrivere testbench per reti combinatorie abbiamo sfruttato la loro inerente semplicità: dato un nuovo ingresso, una rete combinatoria emette l&#x27;output corrispondente dopo un certo tempo. Questo output non varierà nel tempo finché manteniamo l&#x27;input costante, anzi in ogni caso allo stesso input corrisponde lo stesso output.
Questo ci permette di scrivere testbench semplici basate sulla struttura 1) assegno gli ingressi, 2) attendo un tempo sufficiente, 3) controllo le uscite.</p>
<p>Questo non è però fattibile con le reti sincronizzate: a un singolo ingresso possono corrispondere diversi cambi di stato ed uscite diverse, e il tempo necessario al calcolo è difficilmente prevedibile.
Inoltre, se la rete si coordina tramite handshake con altre reti, non si può determinare a priori in quale ordine eseguirà questi handshake.
È necessario quindi adottare una struttura che permette a ciascun componente con cui la rete testata interagisce di comportarsi come un componente <em>indipendente</em> che non è bloccato dal proseguire degli altri - proprio come hardware vero.</p>
<p>Questo è possibile con il costrutto <code>fork ... join</code>.
All&#x27;interno di un <code>fork ... join</code> possiamo definire diversi blocchi <code>begin ... end</code> il cui codice verrà eseguito indipendentemente e in parallelo.
Possiamo quindi sfruttare questo per rappresentare diversi componenti.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token block function" style="color:#d73a49">fork</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Producer_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Producer_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token block function" style="color:#d73a49">join</span><br></span></code></pre></div></div>
<p>All&#x27;interno dei blocchi <code>Producer</code> scriveremo codice per fornire dati di input alla rete, all&#x27;interno dei blocchi <code>Consumer</code> scriveremo codice per ottenere i dati di output della rete e verificare che questi corrispondano a quanto atteso.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="timeout-di-simulazione">Timeout di simulazione<a href="#timeout-di-simulazione" class="hash-link" aria-label="Link diretto a Timeout di simulazione" title="Link diretto a Timeout di simulazione" translate="no">​</a></h4>
<p>Un tipo di problema che possiamo incontrare nelle reti sincronizzate ma non nelle reti combinatorie è la situazione in cui un componente resta in attesa di un segnale che in realtà non verrà mai emesso.
Per esempio, questo avviene se la rete da noi realizzata non rispetta il protocollo di handshake.</p>
<p>In questi casi, la simulazione può proseguire <em>indefinitivamente</em>.</p>
<p>È quindi necessario prevedere un meccanismo di timeout che interrompe la simulazione quando questa stia durando molto più di quanto è ragionevole aspettarsi.
Possiamo realizzare questo utilizzando sempre <code>fork ... join</code>.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">//the following structure is used to wait for expected signals, and fail if too much time passes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token block function" style="color:#d73a49">fork</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token delay constant" style="color:#36acaa">#100000</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        $display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">&quot;Timeout </span><span class="token brackets operator" style="color:#393A34">-</span><span class="token plain"> waiting </span><span class="token block function" style="color:#d73a49">for</span><span class="token plain"> signal failed&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        disable f;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">//actual tests start here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic">//reset phase</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token block function" style="color:#d73a49">fork</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Producer_1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Producer_2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Consumer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token block function" style="color:#d73a49">join</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token block function" style="color:#d73a49">join</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$finish;</span><br></span></code></pre></div></div>
<p>Combinando <code>disable f</code>, che interrompe ogni esecuzione all&#x27;interno del <code>fork ... join</code> iniziale, e <code>$finish</code> dopo di questo ci assicuriamo che quando il timeout è raggiunto la simulazione viene terminata.
Questo ci lascerà una waveform che potremo analizzare per capire da dove sia scaturito il blocco.</p>
<h4 class="anchor anchorWithStickyNavbar_LWe7" id="linee-di-errore">Linee di errore<a href="#linee-di-errore" class="hash-link" aria-label="Link diretto a Linee di errore" title="Link diretto a Linee di errore" translate="no">​</a></h4>
<p>Le simulazioni di reti sincronizzate possono essere molto lunghe (in termini di tempo simulativo, non tempo reale) producendo di conseguenza waveform molto lunghe.
Analizzare queste waveform in cerca di errori può essere molto tedioso.
Per questo, le testbench d&#x27;esame includono solitamente delle <em>linee di errore</em>, che evidenziano a colpo d&#x27;occhio dov&#x27;è che sia avvenuto un problema.</p>
<p>Queste linee sono realizzate nella testbench con una variabile <code>reg error</code> inizializzata a 0 e un blocco <code>always</code> che risponde ad ogni variazione di <code>error</code> per rimetterla a 0 dopo una breve attesa.
Questa attesa breve ma non nulla fa sì che basti assegnare 1 ad <code>error</code> per ottenere un&#x27;impulso sulla linea, facilmente visibile.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token block function" style="color:#d73a49">module</span><span class="token plain"> testbench</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">initial</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token block function" style="color:#d73a49">end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token declaration variable" style="color:#36acaa">reg</span><span class="token plain"> error;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token behavior keyword" style="color:#00009f">initial</span><span class="token plain"> error </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token behavior keyword" style="color:#00009f">always</span><span class="token plain"> @</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">posedge error</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token delay constant" style="color:#36acaa">#1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        error </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token block function" style="color:#d73a49">endmodule</span><br></span></code></pre></div></div>
<p>Possiamo quindi scrivere un check dell&#x27;output come segue.</p>
<div class="language-verilog codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-verilog codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token block function" style="color:#d73a49">if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">p !</span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> t_p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token block function" style="color:#d73a49">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    $display</span><span class="token punctuation" style="color:#393A34">(</span><span class="token literal-string string" style="color:#e3116c">&quot;Expected %d, received %d&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> t_p</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    error </span><span class="token assignment keyword" style="color:#00009f">=</span><span class="token plain"> 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token block function" style="color:#d73a49">end</span><br></span></code></pre></div></div>
<p>In GTKWave, guarando alla linea <code>error</code> della testbench questi punti saranno facilmente identificabili nella waveform, come dall&#x27;esempio seguente.</p>
<img src="/reti-logiche-esercitazioni/2024-25/img/verilog/3/error-line-perimetro.png" style="max-width:min(100%, 60rem)" alt="
Vista in GTKWave di una rete da esame, su un orizzonte di una trentina di cambi di stato.
Gli impulsi sulla linea &#x27;error&#x27; mostrano gli istanti di interesse dove è stato rilevato un errore.
"></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Pagina del documento"><a class="pagination-nav__link pagination-nav__link--prev" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 2"><div class="pagination-nav__sublabel">Precedente</div><div class="pagination-nav__label">Esercitazione 2</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/reti-logiche-esercitazioni/2024-25/esercitazioni/Verilog/Esercitazioni/Esercitazione 4"><div class="pagination-nav__sublabel">Successivo</div><div class="pagination-nav__label">Esercitazione 4</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#reti-sincronizzate" class="table-of-contents__link toc-highlight">Reti sincronizzate</a><ul><li><a href="#testbench-e-generatore-di-clock" class="table-of-contents__link toc-highlight">Testbench e generatore di clock</a></li><li><a href="#primo-esempio-di-rete-sincronizzata-il-contatore" class="table-of-contents__link toc-highlight">Primo esempio di rete sincronizzata: il contatore</a></li><li><a href="#mantenere-un-segnale-per-n-cicli-di-clock" class="table-of-contents__link toc-highlight">Mantenere un segnale per N cicli di clock</a></li><li><a href="#esercizio-handshake-e-reti-combinatorie" class="table-of-contents__link toc-highlight">Esercizio: Handshake e reti combinatorie</a></li><li><a href="#testbench-con-input-e-output-per-reti-sincronizzate" class="table-of-contents__link toc-highlight">Testbench con input e output per reti sincronizzate</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Raffaele Zippo. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>